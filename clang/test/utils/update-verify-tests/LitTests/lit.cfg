import lit.formats
import lit.llvm
lit.llvm.initialize(lit_config, config)
from lit.llvm import llvm_config
from os.path import dirname

config.name = "Lit Update Verify Tests"
config.test_format = lit.formats.ShTest(not llvm_config.use_lit_shell)
config.suffixes = [
    ".c",
]
config.test_source_root = dirname(__file__)
config.target_triple = None
config.host_triple = None

config.llvm_tools_dir = lit_config.path[0] # --path is explicitly passed by lit-plugin.test
llvm_config.use_default_substitutions()
llvm_config.use_clang()
config.substitutions.append(("%clang_cc1", "%clang -cc1"))

if lit_config.update_tests:
    import sys
    import os
    
    config.clang_src_dir = dirname(dirname(dirname(dirname(config.test_source_root))))
    utilspath = os.path.join(config.clang_src_dir, "utils")
    sys.path.append(utilspath)
    from UpdateVerifyTests.litplugin import verify_test_updater
    # normally we'd append to the existing list, but when testing
    # verify_test_updater we don't want diff_test_updater to accidentally interfere
    lit_config.test_updaters = [verify_test_updater]
