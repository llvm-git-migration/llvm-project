; NOTE: Assertions have been autogenerated by utils/update_test_checks.py UTC_ARGS: --version 3
; RUN: opt -mtriple=amdgcn-amd-amdhsa -mcpu=gfx90a -S -passes=separate-const-offset-from-gep < %s | FileCheck %s

define void @inbounds(ptr %in.ptr, i64 %in.idx0, i64 %in.idx1, i64 %in.idx2) {
; CHECK-LABEL: define void @inbounds(
; CHECK-SAME: ptr [[IN_PTR:%.*]], i64 [[IN_IDX0:%.*]], i64 [[IN_IDX1:%.*]], i64 [[IN_IDX2:%.*]]) #[[ATTR0:[0-9]+]] {
; CHECK-NEXT:  entry:
; CHECK-NEXT:    [[CONST1:%.*]] = getelementptr inbounds <16 x i16>, ptr [[IN_PTR]], i64 2
; CHECK-NEXT:    [[IDX1:%.*]] = getelementptr inbounds <16 x i16>, ptr [[CONST1]], i64 [[IN_IDX1]]
; CHECK-NEXT:    [[CONST2:%.*]] = getelementptr <16 x i16>, ptr [[IN_PTR]], i64 24
; CHECK-NEXT:    [[IDX2:%.*]] = getelementptr inbounds <16 x i16>, ptr [[CONST2]], i64 [[IN_IDX1]]
; CHECK-NEXT:    [[CONST3:%.*]] = getelementptr inbounds <16 x i16>, ptr [[IN_PTR]], i64 6
; CHECK-NEXT:    [[IDX3:%.*]] = getelementptr <16 x i16>, ptr [[CONST3]], i64 [[IN_IDX2]]
; CHECK-NEXT:    [[TMP0:%.*]] = getelementptr <16 x i16>, ptr [[IN_PTR]], i64 [[IN_IDX2]]
; CHECK-NEXT:    [[TMP1:%.*]] = getelementptr <16 x i16>, ptr [[TMP0]], i64 28
; CHECK-NEXT:    ret void
;
entry:
  %const1 = getelementptr inbounds <16 x i16>, ptr %in.ptr, i64 2
  %idx1 = getelementptr inbounds <16 x i16>, ptr %const1, i64 %in.idx1
  %const2 = getelementptr <16 x i16>, ptr %in.ptr, i64 24
  %idx2 = getelementptr inbounds <16 x i16>, ptr %const2, i64 %in.idx1
  %const3 = getelementptr inbounds <16 x i16>, ptr %in.ptr, i64 6
  %idx3 = getelementptr <16 x i16>, ptr %const3, i64 %in.idx2
  %const4 = getelementptr <16 x i16>, ptr %in.ptr, i64 28
  %idx4 = getelementptr <16 x i16>, ptr %const4, i64 %in.idx2
  ret void
}
