# RUN: yaml2obj %p/Inputs/srec-elf-sections.yaml -o %t
# RUN: llvm-objcopy -O srec %t - | FileCheck %s

## Check that section address range overlapping 32 bit range
## triggers an error
# RUN: yaml2obj %p/Inputs/srec-elf-sections-err.yaml -o %t.err
# RUN: not llvm-objcopy -O srec --only-section=.text1 %t.err - 2>&1 \
#   RUN: | FileCheck %s --check-prefix=BAD-ADDR
# RUN: not llvm-objcopy -O srec --only-section=.text2 %t.err - 2>&1 \
#   RUN: | FileCheck %s --check-prefix=BAD-ADDR2

## Check that zero length section is not written
# RUN: llvm-objcopy -O srec --only-section=.text %t.err - \
#   RUN:| FileCheck %s --check-prefix=ZERO_SIZE_SEC

## Terminator should contain the entry point
# RUN: llvm-objcopy -O srec --set-start=0xF0000000 %t \
#   RUN: --only-section=.dummy - 2>&1 | FileCheck %s --check-prefix=ENTRY

## Sign-extended entry point is OK
# RUN: llvm-objcopy -O srec --set-start=0xFFFFFFFFF0000000 %t \
#   RUN: --only-section=.dummy - 2>&1 | FileCheck %s --check-prefix=ENTRY

## Start address which exceeds 32 bit range triggers an error
# RUN: not llvm-objcopy -O srec --set-start=0xF00000000 %t - 2>&1 \
#   RUN: | FileCheck %s --check-prefix=BAD_START

## Sign-extended start address which exceeds 32 bit range triggers an error
# RUN: not llvm-objcopy -O srec --set-start=0xFFFFFFFF0F000000 %t - 2>&1 \
#   RUN: | FileCheck %s --check-prefix=BAD_EXTENDED_START

## Records should use segment physical addresses
# RUN: yaml2obj %p/Inputs/ihex-elf-segments.yaml -o %t.seg
# RUN: llvm-objcopy -O srec %t.seg - | FileCheck %s --check-prefix=PADDR

## # The record type for the header should be S0 with a 2 byte address
## of 0. For an output file named "-" the header data field should contain "2D"
## The byte count field should therefore have a value of 4: 2 bytes for address,
## 1 byte for output file and 1 byte for checksum
# CHECK: S00400002DCE
# CHECK-NEXT: S31500001000000102030405060708090A0B0C0D0E0F62
# CHECK-NEXT: S30A0000101010111213147B
# CHECK-NEXT: S30F00EFFFFF1111111111111111111159
# CHECK-NEXT: S31000FFFFF83031323334353637383940AC
# CHECK-NEXT: S30A8000100000010203045B
# CHECK-NEXT: S70500000000FA

# PADDR: S00400002DCE
# PADDR-NEXT: S214100000000102030405060708090A0B0C0D0E0F63
# PADDR-NEXT: S20910001010111213147C
# PADDR-NEXT: S20F10001830313233343536373839407B
# PADDR-NEXT: S20810002840414243B9
# PADDR-NEXT: S20F100030505152535455565758596003
# PADDR-NEXT: S20720FFF8000000E1
# PADDR-NEXT: S804100000EB

# BAD-ADDR: Section '.text1' address range [0xfffffff8, 0x100000000] is not 32 bit
# BAD-ADDR2: Section '.text2' address range [0xffffffff0, 0xffffffff4] is not 32 bit

# there should be no records besides header and terminator
# ZERO_SIZE_SEC-NOT: {{S[1-8]}}
# ZERO_SIZE_SEC: S00400002DCE
# ZERO_SIZE_SEC-NEXT: S9030000FC

# ENTRY: S00400002DCE
# ENTRY-NEXT: S705F00000000A

# BAD_START: Entry point address 0xf00000000 overflows 32 bits

# BAD_EXTENDED_START: Entry point address 0xffffffff0f000000 overflows 32 bits
