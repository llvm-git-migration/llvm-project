; NOTE: Assertions have been autogenerated by utils/update_llc_test_checks.py UTC_ARGS: --version 4
; RUN: llc < %s -mtriple=x86_64-unknown-linux-gnu | FileCheck %s

define <8 x i32> @foo(<8 x i32> %arg1, i32 %n) #0 {
; CHECK-LABEL: foo:
; CHECK:       # %bb.0: # %entry
; CHECK-NEXT:    vmovups %ymm0, -{{[0-9]+}}(%rsp)
; CHECK-NEXT:    # kill: def $edi killed $edi def $rdi
; CHECK-NEXT:    andl $7, %edi
; CHECK-NEXT:    movl $42, -40(%rsp,%rdi,4)
; CHECK-NEXT:    vmovups -{{[0-9]+}}(%rsp), %ymm0
; CHECK-NEXT:    retq
entry:
  %a = insertelement <8 x i32> %arg1, i32 42, i32 %n
  ret <8 x i32> %a
}

attributes #0 = { "no-realign-stack" "target-cpu"="haswell" }
