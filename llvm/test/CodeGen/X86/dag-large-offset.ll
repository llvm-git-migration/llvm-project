; NOTE: Assertions have been autogenerated by utils/update_llc_test_checks.py UTC_ARGS: --version 5
; RUN: llc < %s -mtriple=i386-pc-windows-msvc | FileCheck %s

define dso_local noundef i32 @foo(i1 %b) local_unnamed_addr #0 {
; CHECK-LABEL: foo:
; CHECK:       # %bb.0: # %entry
; CHECK-NEXT:    pushl %ebp
; CHECK-NEXT:    movl %esp, %ebp
; CHECK-NEXT:    pushl %esi
; CHECK-NEXT:    subl $8, %esp
; CHECK-NEXT:    movl ___security_cookie, %eax
; CHECK-NEXT:    xorl %ebp, %eax
; CHECK-NEXT:    movl %eax, -8(%ebp)
; CHECK-NEXT:    movl $-2147483647, %eax # imm = 0x80000001
; CHECK-NEXT:    addl %ebp, %eax
; CHECK-NEXT:    addl $-9, %eax
; CHECK-NEXT:    xorl %esi, %esi
; CHECK-NEXT:    testb $1, 8(%ebp)
; CHECK-NEXT:    cmovnel %eax, %esi
; CHECK-NEXT:    movl -8(%ebp), %ecx
; CHECK-NEXT:    xorl %ebp, %ecx
; CHECK-NEXT:    calll @__security_check_cookie@4
; CHECK-NEXT:    movl %esi, %eax
; CHECK-NEXT:    addl $8, %esp
; CHECK-NEXT:    popl %esi
; CHECK-NEXT:    popl %ebp
; CHECK-NEXT:    retl
entry:
  %a = alloca i8, align 1
  %0 = ptrtoint ptr %a to i32
  %sub = add i32 %0, -2147483647
  %retval.0 = select i1 %b, i32 %sub, i32 0
  ret i32 %retval.0
}

attributes #0 = { mustprogress nofree norecurse nosync nounwind sspreq willreturn memory(none) "frame-pointer"="all" "min-legal-vector-width"="0" "no-trapping-math"="true" "stack-protector-buffer-size"="8" "target-cpu"="pentium4" "target-features"="+cmov,+cx8,+fxsr,+mmx,+sse,+sse2,+x87" "tune-cpu"="generic" }
